#!/usr/bin/env python
import sys,os,time,datetime,feedparser,urllib2
from django.utils.timezone import utc
from django.core.exceptions import ObjectDoesNotExist

if os.path.isfile('reader2/settings.py'):
    sys.path.append(os.getcwd())
else:
    sys.exit('Error: not in the root directory of the django project.');

os.environ['DJANGO_SETTINGS_MODULE'] = 'reader2.settings'

from feeds.models import Feed,Meta

for feed in Feed.objects.all():
    print '    updating',feed
    feed.fetchItems()

# if everything went well set the updated field
meta = Meta.load()
meta.updated = datetime.datetime.utcnow().replace(tzinfo=utc)
meta.save()
